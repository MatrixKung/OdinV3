#pragma once

static FAccuracySettings OldAccuracy{};
static FAccuracySettings NewAccuracy{};

bool saved_spread = false;
void setSpread(bool state)
{
	if (!saved_spread)
	{
		OldAccuracy = Globals::LocalWeapon->m_AccuracySettings;
		saved_spread = true;
	}

	if (state)
	{
		NewAccuracy.bUsesAdvancedAccuracy = true;
		NewAccuracy.fAccuracyGainPerSec = 0.0f;
		NewAccuracy.fMaxAccuracy = 1.0f;
		NewAccuracy.fMinAccuracy = 1.0f;
		Globals::LocalWeapon->m_AccuracySettings = NewAccuracy;
	}
	else if (!state && saved_spread)
	{
		Globals::LocalWeapon->m_AccuracySettings = OldAccuracy;
	}
}

void Exploits() {
	ATgPawn* LocalPawn = (ATgPawn*)Globals::LocalPawn;

	if (!Globals::LocalWeapon ||
		!Globals::LocalPawn ||
		!Globals::LocalController ||
		!Globals::WorldInfo) {
		return;
	}

	// TODO: Fix Speedhack lags
	if (config_system.item.speedhack)
		Globals::WorldInfo->TimeDilation = (float)config_system.item.speed;
	else
		Globals::WorldInfo->TimeDilation = 1.0f;

	if (config_system.item.glow)
		LocalPawn->r_bIsWallHacking = true;
	else
		LocalPawn->r_bIsWallHacking = false;

	if (config_system.item.spread)
		setSpread(true);
	else
		setSpread(false);

	if (config_system.item.recoil)
		LocalPawn->m_bUsesRecoil = false;
	else
		LocalPawn->m_bUsesRecoil = true;

	if (config_system.item.thirdPerson)
		Globals::LocalWeapon->m_fForce3PPersistTimer = 5;
	else
		Globals::LocalWeapon->m_fForce3PPersistTimer = 0;
}